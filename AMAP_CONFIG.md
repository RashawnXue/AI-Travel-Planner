# 高德地图快速配置指南

## 当前状态

✅ 代码已集成高德地图 JS API  
⚠️ 正在使用演示 Key（有配额限制）  
📝 建议配置自己的 API Key

## 快速开始（使用演示 Key）

当前代码已包含一个演示 Key，可以直接运行查看效果：

```bash
npm run dev
```

访问任意行程详情页面，即可看到地图显示。

**注意**：演示 Key 有配额限制，仅供测试使用。

## 配置自己的 API Key（推荐）

### 步骤 1: 获取 API Key

1. 访问 [高德开放平台](https://lbs.amap.com/)
2. 注册并登录账号
3. 进入 [控制台](https://console.amap.com/)
4. 创建应用 -> 添加 Key
5. 选择 **Web端(JS API)**
6. 域白名单填写：`localhost` 或 `127.0.0.1`（开发环境）

### 步骤 2: 配置环境变量

创建或编辑 `.env` 文件：

```env
# 高德地图
VITE_AMAP_KEY=你的API_Key
VITE_AMAP_SECURITY_CODE=你的安全密钥（可选）
```

### 步骤 3: 重启开发服务器

```bash
# 停止当前服务器（Ctrl+C）
# 重新启动
npm run dev
```

## 功能说明

### 地图显示内容

- 🟢 **绿色标记**：当天第一个景点（起点）
- 🔵 **紫色数字**：中间景点（按行程顺序）
- 🔴 **红色图标**：最后一个点（住宿）
- 🔷 **蓝色路线**：景点之间的连接线

### 交互功能

- **点击标记**：显示景点详细信息
- **切换天数**：自动更新当天路线
- **自动缩放**：自适应显示所有景点

## 测试数据

项目中的 `docs/seed-data.sql` 包含完整的测试数据，包括：

- 🗾 日本东京 5 日游
- 🏔️ 云南大理 4 日游  
- 🐼 四川成都 3 日游

所有景点都包含真实的经纬度坐标。

## 常见问题

### Q1: 地图显示空白

**可能原因**：
- API Key 未配置或配置错误
- 网络连接问题
- 浏览器阻止了外部脚本

**解决方案**：
1. 打开浏览器控制台（F12）查看错误信息
2. 检查网络请求是否成功
3. 确认 API Key 是否有效

### Q2: 提示 "地图加载失败"

**解决方案**：
1. 检查网络连接
2. 确认高德地图服务是否正常
3. 尝试刷新页面
4. 清除浏览器缓存

### Q3: 地图显示但没有标记

**原因**：行程数据缺少经纬度

**解决方案**：
1. 使用 `docs/seed-data.sql` 导入测试数据
2. 确保行程数据包含 `longitude` 和 `latitude` 字段
3. 查看浏览器控制台是否有相关提示

### Q4: 提示 "当前行程暂无地理位置信息"

这表示当前行程的活动没有经纬度数据。

**解决方案**：
- 切换到其他天数（如果有）
- 使用包含经纬度的测试数据
- 在 AI 生成行程时确保包含经纬度信息

## 技术细节

### 地图加载方式

使用动态加载，避免阻塞页面渲染：

```typescript
// src/utils/amap.ts
// 自动检测环境变量中的 API Key
// 如果未配置，使用演示 Key
```

### 自定义标记

标记使用 HTML 自定义样式：

```css
/* 起点：绿色渐变 */
.custom-marker.start { background: linear-gradient(135deg, #52c41a 0%, #73d13d 100%); }

/* 景点：紫色渐变 */
.custom-marker.middle { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }

/* 终点：红色渐变 */
.custom-marker.end { background: linear-gradient(135deg, #ff4d4f 0%, #ff7875 100%); }
```

## 更多帮助

- 📖 [高德地图 JS API 文档](https://lbs.amap.com/api/javascript-api/summary)
- 💬 [开发者社区](https://lbs.amap.com/dev/index)
- 📧 [技术支持](https://lbs.amap.com/support)

## 注意事项

1. **演示 Key 限制**：
   - 仅供测试使用
   - 每日请求有配额限制
   - 生产环境请使用自己的 Key

2. **域名白名单**：
   - 开发环境：`localhost` 或 `127.0.0.1`
   - 生产环境：添加实际域名

3. **HTTPS 要求**：
   - 生产环境建议使用 HTTPS
   - 某些高德 API 功能要求 HTTPS

## 下一步

配置完成后，你可以：

1. ✅ 查看真实的地图展示
2. ✅ 测试景点标记和路线
3. ✅ 体验交互功能
4. 🚀 准备接入 AI 生成行程功能

